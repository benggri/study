# Cluster Upgrade Process

## controlplane node

```bash
kubectl drain controlp
```

* This will update the package lists from the software repository.
* 소프트웨어 저장소의 패키지 목록이 업데이트됩니다

```bash
kubectl drain controlplane --ignore-daemonsets
```

* This will install the kubeadm version 1.27.0
* kubeadm 버전 1.27.0이 설치됩니다

```bash
apt-get install kubeadm=1.27.0-00
```

* This will upgrade Kubernetes controlplane node.
* Kubernetes controlplane 노드가 업그레이드됩니다.

```bash
kubeadm upgrade apply v1.27.0
```

* Note that the above steps can take a few minutes to complete.
* 위 단계를 완료하는 데 몇 분 정도 걸릴 수 있습니다.

* This will update the kubelet with the version 1.27.0.
* kubelet이 버전 1.27.0으로 업데이트됩니다.

```bash
apt-get install kubelet=1.27.0-00 
```

* You may need to reload the daemon and restart kubelet service after it has been upgraded.
* 업그레이드된 후 데몬을 다시 로드하고 kubelet 서비스를 다시 시작해야 할 수도 있습니다.

```bash
systemctl daemon-reload
systemctl restart kubelet
```

```bash
kubectl uncordon controlplane
```

## worker nodes

```bash
kubectl drain <node_name> --ignore-daemonsets
```

* If you are on the controlplane node, run ssh node01 to log in to the node01.
* controlplane node 에 있는 경우 **ssh <node_name>**을 실행하여 <node_name> 에 로그인합니다.

This will update the package lists from the software repository.

```bash
apt-get update
```

This will install the kubeadm version 1.27.0.

```bash
apt-get install kubeadm=1.27.0-00
```

This will upgrade the node01 configuration.

```bash
kubeadm upgrade node
```

This will update the kubelet with the version 1.27.0.

```bash
apt-get install kubelet=1.27.0-00 
```

You may need to reload the daemon and restart the kubelet service after it has been upgraded.

```bash
systemctl daemon-reload
systemctl restart kubelet
```

Type exit or logout or enter CTRL + d to go back to the controlplane node.

```bash
kubectl uncordon <node_name>
```