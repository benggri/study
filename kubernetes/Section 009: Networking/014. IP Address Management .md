# IPAM(IP Address Management)

```

 -------------------          -------------------          -------------------      
|   -----   -----   |        |       -----       |        |       -----       |     
|  | POD | | POD |  |        |      | POD |      |        |      | POD |      |     
|   -----   -----   |        |       -----       |        |       -----       |     
|     |       |     |        |         |         |        |         |         |     
|      -------      |        |         |         |        |         |         |     
|         |         |        |         |         |        |         |         |     
|     ---------     |        |     ---------     |        |     ---------     |     
|    | Bridge  |    |        |    | Bridge  |    |        |    | Bridge  |    |     
|    | v-net-0 |    |        |    | v-net-0 |    |        |    | v-net-0 |    |     
|     ---------     |        |     ---------     |        |     ---------     |     
|                   |        |                   |        |                   |     
|  --------         |        |  --------         |        |  --------         |     
| | docker |        |        | | docker |        |        | | docker |        |     
|  --------         |        |  --------         |        |  --------         |     
|                   |        |                   |        |                   |     
 -------------------          -------------------          -------------------      
 Node1    | 192.168.1.11      Node2    | 192.168.1.12      Node3    | 192.168.1.13  
          |                            |                            |               
          |                            |                            |               
          |                            |                            |               
          |                   -------------------                   |               
          |                  |        LAN        |                  |               
           ------------------|    192.168.1.11   |------------------                
                             |                   |                                  
                              -------------------                                   
```



## IP Address 관리와 Kubernetes 는 어떻게 작동하는가?

* Network Node 에 할당된 IP 주소와 관련이 없고 직접 관리할 수 있고 외부 IPAM 솔루션으로 관리할 수 있다
* Node 에서 가상 bridge network 가 어떻게 IP subnet 을 할당되느냐?
* Pod 도 어떻게 IP 를 할당되느냐?
* 누가 관리하는지?
* 중복 IP는 누가 배정하는지?
* => 기준을 정하는 것은 CNI
* => Network Solution 공급자인 CNI Plugin 의 임무는 Container 에 IP 를 할당하는 것


## Container Network Interface(CNI)



```

 -----------------------------    -------------------          -------------------          -------------------      
|                             |  |   -----   -----   |        |       -----       |        |       -----       |     
| Container Network Interface |  |  | POD | | POD |  |        |      | POD |      |        |      | POD |      |     
| (CNI)                       |  |   -----   -----   |        |       -----       |        |       -----       |     
 -----------------------------   |     |       |     |        |         |         |        |         |         |     
                                 |      -------      |        |         |         |        |         |         |     
 ------           ------------   |         |         |        |         |         |        |         |         |     
| DHCP |         | host-local |  |     ---------     |        |     ---------     |        |     ---------     |     
 ------           ------------   |    | Bridge  |    |        |    | Bridge  |    |        |    | Bridge  |    |     
                                 |    | v-net-0 |    |        |    | v-net-0 |    |        |    | v-net-0 |    |     
                                 |     ---------     |        |     ---------     |        |     ---------     |     
                                 |                   |        |                   |        |                   |     
                                 |  --------         |        |  --------         |        |  --------         |     
                                 | | docker |        |        | | docker |        |        | | docker |        |     
                                 |  --------         |        |  --------         |        |  --------         |     
                                 |                   |        |                   |        |                   |     
                                  -------------------          -------------------          -------------------      
                                  Node1    | 192.168.1.11      Node2    | 192.168.1.12      Node3    | 192.168.1.13  
                                           |                            |                            |               
                                           |                            |                            |               
                                           |                            |                            |               
                                           |                   -------------------                   |               
                                           |                  |        LAN        |                  |               
                                            ------------------|    192.168.1.11   |------------------                
                                                              |                   |                                  
                                                               -------------------                                   
```

* CNI Configuration 파일에는 IPAM 이라는 영역이 있다

```bash
cat /etc/cni/net.d/net-script.conf
```

* 여기서 사용될 Plugin 의 유형을 지정할 수 있다
* Subnet 과 Routes 도 지정할 수 있다


```
10.32.0.0/12

10.32.0.1 > 10.47.255.254

1,048,574 개의 IP를 사용할 수 있다
```