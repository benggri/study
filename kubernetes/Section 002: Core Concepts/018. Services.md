# Services

* Application 의 안밖의 다양한 구성 요소 간의 통신을 가능하게 한다
* **kubernetes service** 는 Application 을 다른 Application 또는 사용자와 연결할 수 있게 한다

```
        --------------- 
       | Endpoint User |
        --------------- 
               |
           --------- 
          | service |
           --------- 
               |
        --------------- 
       | Front End Pod |
        --------------- 
               |
        --------------- 
       |               |
   ---------       ---------      
  | service |     | service |     
   ---------       ---------      
       |               |          
 --------------     --------      ---------     ------ 
| Back End Pod |   | DB Pod |----| service |---| DBMS |      
 --------------     --------      ---------     ------ 
```

## Service Types

### NodePort

* Service 가 Node 의 Port 에 내부 Port 를 Access 하게 한다

```
                                          ------------- 
                                        -| 192.168.1.2 |------------------- 
                                       |  -------------      ------------  |
                                       |                    | 10.244.0.0 | |
                                       |                     ------------  |
 ------     -------------------     -------     ---------          |       |
| User |---| 192.168.1.2:30008 |---| 30008 |---| Service |---------|       |
 ------     -------------------     -------     ---------          |       |
                                       |                     ------------  |
                                       |                    | 10.244.0.2 | |
                                       |                     ------------  |
                                       |                    | POD        | |
                                       |                     ------------  |
                                       |                                   |
                                       | Node                              |
                                        -----------------------------------
```

```
     ------------------------------------------  
    |                                          |
 -------                                       |
|       |                                      |
| 30008 |-   -----------                       | => 3. NodePort (Range: 30000~32767)
|       | | |           |                      |
 -------  | |          ----                    |
    |      -| Service | 80 |---------          | => 2. Port
    |       |          ----          |         |    || 
    |       |           |            |         |    ||=> 두개의 Port 값이 같아야함
    |        -----------           ----        |    || 
    |                          ---| 80 |---    | => 1. TargetPort
    |                         |    ----    |   |
    |                         | 10.244.0.2 |   |
    |                          ------------    |
    |                         | POD        |   |
    |                          ------------    |
    | Node                                     |
     ------------------------------------------ 
```

```yml
apiVersion: v1
kind: Service
metadata:
  name: <service_name>
spec:
  type: NodePort
  ports:
    - targetPort: 80
      port: 80
      nodePort: 30008
  selector:
    key: value
    app: myapp          # POD yml => metadata.label.app: myapp 
    type: myapp-front
```

```
 ---------------------------   ---------------------------   ---------------------------  
|  -------------   -------  | |  -------------   -------  | |  -------------   -------  | 
| | 192.168.1.2 | | 30008 | | | | 192.168.1.3 | | 30008 | | | | 192.168.1.4 | | 30008 | | 
|  -------------   -------  | |  -------------   -------  | |  -------------   -------  | 
|  -----------------------------------------------------------------------------------  | 
| |                                    Service                                        | | 
|  -----------------------------------------------------------------------------------  | 
|  ------------             | |  ------------             | |  ------------             | 
| | 10.244.0.3 |            | | | 10.244.0.2 |            | | | 10.244.0.4 |            | 
| | POD        |            | | | POD        |            | | | POD        |            | 
|  ------------             | |  ------------             | |  ------------             | 
|                           | |                           | |                           | 
| Node                      | | Node                      | | Node                      | 
 ---------------------------   ---------------------------   ---------------------------  
```

### ClusterIP

* Cluster 안에서 가상 IP 를 만들어 다양한 Service 간 통신을 가능하게 한다

### LoadBalancer

* 지원되는 Cloud Provider 에서 Application 을 위해 Loadbalancer 를 provision 한다
