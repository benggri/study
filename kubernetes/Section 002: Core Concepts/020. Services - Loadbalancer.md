# Services - Loadbalancer

```
                    ^                                       ^
 -------------------^---------------------------------------^----------------------------- 
|                                  app1 service 30035       ^                             |
 -----------------------------------------------------------^----------------------------- 
 -----------------------------------------------------------^----------------------------- 
|                                  app2 service 31061                                     |
 ----------------------------------------------------------------------------------------- 
 -------------------   --------------------     -------------------   --------------------  
| 192.168.56.70     | | 192.168.56.71      |   | 192.168.56.72     | | 192.168.56.73      | 
|          ------------------------------  |   |          ------------------------------  | 
|         |  ------    ------    ------  | |   |         |  ------    ------    ------  | | 
|         | | app1 |  | app1 |  | app1 | | |   |         | | app2 |  | app2 |  | app2 | | | 
|         | | POD  |  | POD  |  | POD  | | |   |         | | POD  |  | POD  |  | POD  | | | 
|         |  ------    ------    ------  | |   |         |  ------    ------    ------  | | 
|         |                              | |   |         |                              | | 
|         | Deployment                   | |   |         | Deployment                   | | 
|          ------------------------------  |   |          ------------------------------  | 
|                   | |                    |   |                   | |                    | 
| Node              | | Node               |   | Node              | | Node               | 
 -------------------   --------------------     -------------------   --------------------  
```

## app1 에 접근할 수 있는 방법

* 192.168.56.70:30035
* 192.168.56.71:30035
* 192.168.56.72:30035
* 192.168.56.73:30035

## app2 에 접근할 수 있는 방법

* 192.168.56.70:31061
* 192.168.56.71:31061
* 192.168.56.72:31061
* 192.168.56.73:31061

## 사용자는 URL 로 접근하고 싶다

* User 는 http://app1.com 나 http://app2.com 로 Application 에 접근할 수 있도록 해야한다
* Load Balancer 를 할 수 있도록 VM 을 하나 만든다
* nginx 같은 Load Balancer 를 설치하고 구성한다
* 그리고 기본 Node 로 Traffic 을 Route 한다 
* 모든 외부 부하 분산을 설정하고 유지하고 관리하는 것은 많은 시간이 필요하다

```
 ----------------------------------------------------------------------------------------- 
| User                                                                                    |
 ----------------------------------------------------------------------------------------- 
                                        || http://app1.com
                                        || http://app2.com
 ----------------------------------------------------------------------------------------- 
| Load Balancer                                                                           |
 ----------------------------------------------------------------------------------------- 
                    ^                                       ^
 -------------------^---------------------------------------^----------------------------- 
|                                  app1 service 30035       ^                             |
 -----------------------------------------------------------^----------------------------- 
 -----------------------------------------------------------^----------------------------- 
|                                  app2 service 31061                                     |
 ----------------------------------------------------------------------------------------- 
 -------------------   --------------------     -------------------   --------------------  
| 192.168.56.70     | | 192.168.56.71      |   | 192.168.56.72     | | 192.168.56.73      | 
|          ------------------------------  |   |          ------------------------------  | 
|         |  ------    ------    ------  | |   |         |  ------    ------    ------  | | 
|         | | app1 |  | app1 |  | app1 | | |   |         | | app2 |  | app2 |  | app2 | | | 
|         | | POD  |  | POD  |  | POD  | | |   |         | | POD  |  | POD  |  | POD  | | | 
|         |  ------    ------    ------  | |   |         |  ------    ------    ------  | | 
|         |                              | |   |         |                              | | 
|         | Deployment                   | |   |         | Deployment                   | | 
|          ------------------------------  |   |          ------------------------------  | 
|                   | |                    |   |                   | |                    | 
| Node              | | Node               |   | Node              | | Node               | 
 -------------------   --------------------     -------------------   --------------------  
```

* GCP, AWS, MS Azure 같이 지원되는 Cloud Platform 이 있다면 해당 Cloud Platform 의 native load balancer 를 활용할 수 있다
* Kubernetes 는 특정 Cloud Platform 의 native load balancer 와 통합을 지원한다

```yml
apiVersion: v1
kind: Service
metadata: 
  name: <service_name>
spec:
  type: LoadBalancer
  ports:
    - targetPort: 80
      port: 80
      nodePort: 30008
```