# Configure High Availability

* Cluster 의 Master Node 가 사라지더라도 Conatiner 가 살아 있는 한 Application 은 동작한다
* Pod 가 ReplicaSet 에 의해 생성되었다면 새 Pod 를 생성할 수 없다
* 따라서 고가용성을 위해서 다중 Master Node 를 고려해야한다

```
 -------------     -------------   ------------- 
|             |   |             | |             |
| Master Node |   | Worker Node | | Worker Node |
|             |   |             | |             |
 -------------     -------------   ------------- 
```

* Master Node 1개와 Workder Node 2개가 있다
* 그 중 Master Node 의 세부사항을 확인한다

```
 -------------  
|             | 
| Master Node | 
|             | 
 -------------  
```

* Master Node 는 Control Plane 구성 요소를 Hosting 한다


```
 ------------------------------  
| Master Node                  | 
|  ------         --------     | 
| | ETCD |       | API    |    | 
| |      |       | Server |    | 
|  ------         --------     | 
|  ------------   -----------  | 
| | Controller | | Scheduler | | 
| | Manager    | | Scheduler | | 
|  ------------   -----------  | 
 ------------------------------  
```

* Master Node 를 추가하면 새로운 Master Node 에서도 같은 구성 요소가 실행된다

```
 ------------------------------   ------------------------------  
| Master Node                  | | Master Node                  | 
|  ------         --------     | |  ------         --------     | 
| | ETCD |       | API    |    | | | ETCD |       | API    |    | 
| |      |       | Server |    | | |      |       | Server |    | 
|  ------         --------     | |  ------         --------     | 
|  ------------   -----------  | |  ------------   -----------  | 
| | Controller | | Scheduler | | | | Controller | | Scheduler | | 
| | Manager    | | Scheduler | | | | Manager    | | Scheduler | | 
|  ------------   -----------  | |  ------------   -----------  | 
 ------------------------------   ------------------------------  
```

* 같은 Component 의 여러 instance 를 실행하면 같은 일을 두번하지 않나?

* API Server 
  * 요청을 수신하고 프로세싱하고 Cluster 의 정보를 제공한다
  * 한 번에 하나씩 요청에 따라 작업돼 Cluster Node 전체의 API Service 가 Active Active 모드로 동시에 살아 실행된다
    ```
     -------------   -------------  
    | Active      | | Active      | 
     -------------   -------------  
    | Master Node | | Master Node | 
    |  --------   | |  --------   | 
    | | API    |  | | | API    |  | 
    | | Server |  | | | Server |  | 
    |  --------   | |  --------   | 
     -------------   -------------  
    ```
